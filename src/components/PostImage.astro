---
import { Image, getImage } from "astro:assets";
import type { LocalImageProps } from "astro:assets";

interface Props {
  src: LocalImageProps["src"];
  alt: string;
}

const { src, alt } = Astro.props;

// 1. Get the image URL path
// If 'src' is an imported object (from src/images), use .src
// If 'src' is a string (from public/), use it directly
const imageUrl = new URL((await getImage({ src, format: "jpg" })).src, Astro.url).href;
const licenseUrl = new URL("/terms#1-content-images--text", Astro.url).href;

// 3. Define the Structured Data
const schema = {
  "@context": "https://schema.org/",
  "@type": "ImageObject",
  contentUrl: imageUrl,
  license: licenseUrl,
  acquireLicensePage: licenseUrl,
  creditText: "Zarema Khalilova / Zmoki",
  creator: {
    "@type": "Person",
    name: "Zarema Khalilova",
  },
  copyrightNotice: "CC BY-NC 4.0",
};
---

<figure class="!my-0 flex w-full flex-col items-center">
  <Image
    src={src}
    alt={alt}
    width={1200}
    height={800}
    loading="lazy"
    class="rounded-lg shadow-lg"
  />
  <figcaption class="!mt-0 text-center text-sm text-gray-500">
    <slot />
  </figcaption>

  {/* Inject the Structured Data */}
  <script type="application/ld+json" set:html={JSON.stringify(schema)} />
</figure>
